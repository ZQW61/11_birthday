<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>æ¸…ç¥ç”Ÿæ—¥äº’åŠ¨ç¨‹åº</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
    }

    .container {
      width: 100%;
      max-width: 420px;
      padding: 16px;
    }

    .card {
      position: relative;
      background: rgba(255, 255, 255, 0.96);
      border-radius: 24px;
      padding: 20px 18px 22px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255, 105, 180, 0.08);
      font-size: 12px;
      color: #ff4f8b;
      margin-bottom: 8px;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #ff4f8b;
      margin-right: 6px;
      animation: pulse 1.4s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      70% { transform: scale(1.6); opacity: 0; }
      100% { transform: scale(1.6); opacity: 0; }
    }

    h1 {
      font-size: 22px;
      margin-bottom: 6px;
      color: #333;
    }

    .subtitle {
      font-size: 14px;
      color: #888;
      margin-bottom: 16px;
      line-height: 1.4;
    }

    .step {
      display: none;
      animation: fadeInUp 0.35s ease;
    }

    .step.active {
      display: block;
    }

    @keyframes fadeInUp {
      0% { opacity: 0; transform: translateY(12px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .btn {
      display: block;
      width: 100%;
      border: none;
      outline: none;
      padding: 12px 14px;
      margin-top: 10px;
      border-radius: 999px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.2s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff8ad4, #ff4f8b);
      color: #fff;
      box-shadow: 0 10px 24px rgba(255, 79, 139, 0.36);
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 6px 18px rgba(255, 79, 139, 0.26);
    }

    .btn-ghost {
      background: #fff7fb;
      color: #ff4f8b;
      border: 1px solid rgba(255, 79, 139, 0.2);
    }

    .btn-ghost:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 4px 10px rgba(255, 79, 139, 0.12);
    }

    .btn-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 4px;
    }

    .small-text {
      font-size: 12px;
      color: #aaa;
      margin-top: 10px;
    }

    .question {
      font-size: 15px;
      font-weight: 500;
      color: #444;
      margin-bottom: 8px;
    }

    .tagline {
      font-size: 13px;
      color: #999;
      margin-bottom: 6px;
    }

    .result-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }

    .result-text {
      font-size: 14px;
      color: #555;
      line-height: 1.6;
      white-space: pre-line;
    }

    .footer {
      margin-top: 12px;
      font-size: 12px;
      color: #bbb;
      text-align: center;
    }

    .blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(2px);
      opacity: 0.7;
      z-index: -1;
    }

    .blob-1 {
      width: 140px;
      height: 140px;
      background: #ffe1f0;
      top: -60px;
      right: -40px;
    }

    .blob-2 {
      width: 110px;
      height: 110px;
      background: #ffe9c9;
      bottom: -40px;
      left: -30px;
    }

    /* å¼¹çª—ç¥ç¦é¢„è§ˆåŒºåŸŸ */
    .popup-area {
      position: relative;
      height: 220px;
      margin: 10px 0 4px;
      background: #fff7fb;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(255, 79, 139, 0.12);
    }

    .popup-card {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 86%;
      padding: 12px 14px;
      border-radius: 18px;
      background: #ffe4f0;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
      color: #5b2341;
      font-size: 13px;
      line-height: 1.5;
      animation: popupIn 0.4s ease;
    }

    .popup-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 13px;
    }

    .popup-text {
      font-size: 13px;
    }

    @keyframes popupIn {
      0% {
        opacity: 0;
        transform: translate(-50%, -60%) scale(0.9);
      }
      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    #confettiCanvas {
      pointer-events: none;
      position: fixed;
      inset: 0;
      z-index: 10;
    }
  </style>
</head>
<body>
  <canvas id="confettiCanvas"></canvas>
  <div class="container">
    <div class="card">
      <div class="blob blob-1"></div>
      <div class="blob blob-2"></div>

      <div class="badge">
        <span class="badge-dot"></span>
        æ¸…ç¥ç”Ÿæ—¥äº’åŠ¨ç¨‹åº Â· v5.0
      </div>

      <h1>Hiï¼Œå°æ¸…ç¥ ğŸ‚</h1>
      <p class="subtitle">
        è¿™æ˜¯å§å§äº²æ‰‹å†™çš„ä¸€ä¸ªå°å°â€œç”Ÿæ—¥ç¨‹åºâ€ï¼Œ<br />
        åªæœ‰ä½ å¯ä»¥è§£é”å“¦ã€‚
      </p>

      <!-- Step 1: å¯åŠ¨ç¨‹åº -->
      <div class="step active" id="step1">
        <p class="question">å‡†å¤‡å¥½æ¥å—æ¥è‡ªå§å§çš„ä¸“å±ç¥ç¦äº†å—ï¼Ÿ</p>
        <p class="tagline">ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¯åŠ¨ç¨‹åº â¬‡ï¸</p>
        <button class="btn btn-primary" id="startBtn">å¯åŠ¨ç”Ÿæ—¥ç¨‹åº</button>
        <p class="small-text">Tipï¼šå»ºè®®å¼€å£°éŸ³ + ç«–å±è§‚çœ‹ï¼Œä»ªå¼æ„Ÿæ›´è¶³ ğŸ’–</p>
      </div>

      <!-- Step 2: Q1 å¿ƒæƒ… -->
      <div class="step" id="step2">
        <p class="question">Q1ï¼šé‚£ä»Šå¤©çš„ä½ ï¼Œæ˜¯å“ªä¸€ç§å¿ƒæƒ…å‘¢ï¼Ÿ</p>
        <p class="tagline">ç‚¹ä¸€ä¸ªæœ€è´´è¿‘ä½ çš„ğŸ‘‡</p>
        <div class="btn-row">
          <button class="btn btn-ghost mood-btn" data-mood="å…ƒæ°”æ»¡æ»¡ã€ç¬‘ç‚¹æ‹‰æ»¡çš„å°å¤ªé˜³">
            â˜€ï¸ ä»Šå¤©è¶…å¼€å¿ƒï¼Œå…ƒæ°”çˆ†æ£š
          </button>
          <button class="btn btn-ghost mood-btn" data-mood="æœ‰ç‚¹ç´¯ä½†è¿˜åœ¨åŠªåŠ›å†²åˆºçš„å‹‡å£«">
            âš¡ æœ‰ç‚¹ç´¯ï¼Œä½†æˆ‘å¾ˆèƒ½æ‰“
          </button>
          <button class="btn btn-ghost mood-btn" data-mood="è¡¨é¢å¾ˆå—¨ï¼Œå†…å¿ƒä¹Ÿå€¼å¾—è¢«å¥½å¥½æŠ±æŠ±çš„å°æœ‹å‹">
            ğŸˆ å¤–å‘çˆ±å—¨ï¼Œä½†ä¹Ÿæƒ³è¢«æŠ±æŠ±
          </button>
        </div>
      </div>

      <!-- Step 3: Q2 ç”Ÿæ—¥è¿‡æ³• -->
      <div class="step" id="step3">
        <p class="question">Q2ï¼šå¦‚æœä»Šå¤©ç»™ä½ é€‰ä¸€ç§â€œç”Ÿæ—¥è¿‡æ³•â€ï¼Œä½ æ›´æƒ³è¦å“ªç§ï¼Ÿ</p>
        <p class="tagline">éšä¾¿é€‰ä¸€ä¸ªï¼Œç¨‹åºä¼šå·å·è®°ä½ ğŸ˜</p>
        <div class="btn-row">
          <button class="btn btn-ghost style-btn" data-style="å’Œä¸€ç¾¤å–œæ¬¢çš„äººä¸€èµ·åµåµé—¹é—¹ã€ç¬‘åˆ°åœä¸ä¸‹æ¥">
            ğŸ‰ è·Ÿæœ‹å‹å—¨ç¿»å¤©
          </button>
          <button class="btn btn-ghost style-btn" data-style="åƒå¥½åƒçš„ã€æ‹å¥½çœ‹çš„ç…§ç‰‡ã€ç•™ä¸‹å¾ˆå¤šçºªå¿µç¬é—´">
            ğŸ° åƒåƒå–å–æ‹æ‹æ‹
          </button>
          <button class="btn btn-ghost style-btn" data-style="å“ªæ€•ä¸–ç•Œå†åµï¼Œæˆ‘ä¹Ÿæœ‰ä¸€å—åªå±äºè‡ªå·±çš„å°å°å®‰é™è§’è½">
            ğŸŒ™ å®‰é™chillä¸€ä¸‹
          </button>
        </div>
      </div>

      <!-- Step 4: Q3 ç»™ä»Šå¹´æ‰“åˆ† -->
      <div class="step" id="step4">
        <p class="question">Q3ï¼šç»™è‡ªå·±è¿™ä¸€å¹´æ‰“ä¸ªåˆ†çš„è¯ï¼Œä½ ä¼šé€‰ï¼š</p>
        <p class="tagline">è¯šå®ä¸€ç‚¹ï¼Œä½†ä¹Ÿè¦æ¸©æŸ”ä¸€ç‚¹å¯¹è‡ªå·± ğŸ˜Œ</p>
        <div class="btn-row">
          <button class="btn btn-ghost score-btn" data-score="80åˆ†ä»¥ä¸Šï¼Œå¾ˆæ£’äº†ï¼Œå†å¤¸ä¸€å˜´å°±æ›´æ£’">
            ğŸŒŸ 80 åˆ†å·¦å³ï¼šå·²ç»ä¸é”™äº†
          </button>
          <button class="btn btn-ghost score-btn" data-score="90åˆ†ä»¥ä¸Šï¼Œç®€ç›´æ˜¯è‡ªå·±çš„è¶…çº§è‹±é›„ç‰ˆæœ¬">
            ğŸ’« 90 åˆ†ï¼šæˆ‘çœŸçš„å¾ˆèƒ½æ‰“
          </button>
          <button class="btn btn-ghost score-btn" data-score="ä¹Ÿè®¸æ²¡æœ‰é‚£ä¹ˆé«˜åˆ†ï¼Œä½†æˆ‘æ¯ä¸€æ­¥éƒ½å¾ˆè®¤çœŸ">
            ğŸ¤ åˆ†æ•°ä¸€èˆ¬ï¼Œä½†æˆ‘å¾ˆåŠªåŠ›
          </button>
        </div>
      </div>

      <!-- Step 5: Q4 å’Œå§å§çš„å…³ç³»æ ‡ç­¾ -->
      <div class="step" id="step5">
        <p class="question">Q4ï¼šé‚£ä½ å’Œå§å§æˆ‘ä»¬çš„å…³ç³»ï¼Œç”¨ä¸€ä¸ªæ ‡ç­¾æ¥è¯´çš„è¯æ›´åƒï¼š</p>
        <p class="tagline">è°¨æ…é€‰æ‹©ï¼Œå§å§ä¼šæˆªå›¾ç•™å­˜ ğŸ˜</p>
        <div class="btn-row">
          <button class="btn btn-ghost rel-btn" data-rel="åˆäº’æŸåˆäº’å® çš„æœ€ä½³æŸå‹+é˜Ÿå‹ç»„åˆ">
            ğŸ˜‚ äº’æŸäº’å® çš„å¥½æ­å­
          </button>
          <button class="btn btn-ghost rel-btn" data-rel="å¯ä»¥éšæ—¶æ’’å¨‡ã€éšæ—¶æ±‚åŠ©çš„å®‰å…¨åŸºåœ°">
            ğŸ«¶ æƒ³æ’’å¨‡å°±ä¼šæ¥æ‰¾çš„å®‰å…¨åŸºåœ°
          </button>
          <button class="btn btn-ghost rel-btn" data-rel="æ˜¯æœ‰ç‚¹å‡¶ä½†åˆè¶…æŠ¤çŸ­çš„äº²å¦ˆå‹å§å§">
            ğŸ˜ è¡¨é¢å«Œå¼ƒã€å…¶å®è¶…æŠ¤çŸ­çš„äº²å¦ˆå‹å§å§
          </button>
        </div>
      </div>

      <!-- Step 6: Q5 æ–°ä¸€å²å…³é”®è¯ -->
      <div class="step" id="step6">
        <p class="question">Q5ï¼šæœ€åä¸€ä¸ªé—®é¢˜ ğŸ‘‡</p>
        <p class="tagline">å¦‚æœç»™è‡ªå·±çš„æ–°ä¸€å²é€‰ä¸€ä¸ªå…³é”®è¯ï¼Œä½ æ›´æƒ³è¦ï¼š</p>
        <div class="btn-row">
          <button class="btn btn-ghost wish-btn" data-wish="å‹‡æ•¢">
            ğŸ’ª æ›´å‹‡æ•¢
          </button>
          <button class="btn btn-ghost wish-btn" data-wish="å¿«ä¹">
            ğŸ˜† æ›´å¿«ä¹
          </button>
          <button class="btn btn-ghost wish-btn" data-wish="è¢«çˆ±">
            â¤ï¸ æ›´è¢«çˆ±
          </button>
        </div>
        <p class="small-text">éšä¾¿é€‰ä¸€ä¸ªå•¦ï¼Œåæ­£å§å§éƒ½æƒ³ä¸€æ¬¡æ€§ç»™ä½ å…¨å¥—ã€‚</p>
      </div>

      <!-- Step 7: ä»¿ CSDN ç¥ç¦å¼¹çª—é¡µ -->
      <div class="step" id="step7">
        <p class="question">å°å½©è›‹ï¼šå§å§çš„ç¢ç¢å¿µå¼¹çª—æ¥å•¦ ğŸ’—</p>
        <p class="tagline">ä¼šä¸€æ¡ä¸€æ¡åœ°å¼¹å‡ºï¼Œä¸ç”¨ç‚¹ä¹Ÿä¼šè‡ªå·±æ¢ä¸‹ä¸€æ¡ï½</p>
        <div class="popup-area" id="popupArea"></div>
        <button class="btn btn-primary" id="startPopupBtn">å¼€å§‹æ’­æ”¾ç¥ç¦å¼¹çª—</button>
        <button class="btn btn-ghost" id="skipToResultBtn">ç›´æ¥çœ‹æœ€ç»ˆç¥ç¦</button>
        <p class="small-text">ï¼ˆæç¤ºï¼šå¯ä»¥å…ˆçœ‹ä¸€è½®å†ç‚¹ã€Œç›´æ¥çœ‹æœ€ç»ˆç¥ç¦ã€ï¼Œä½“éªŒæ›´å®Œæ•´ ğŸ˜†ï¼‰</p>
      </div>

      <!-- Step 8: æœ€ç»ˆç¥ç¦ -->
      <div class="step" id="step8">
        <p class="result-title">ğŸ‰ ç”Ÿæ—¥ç¨‹åºè¿è¡Œç»“æœï¼š</p>
        <p class="result-text" id="resultText"></p>
        <button class="btn btn-primary" id="replayBtn">å†ç©ä¸€æ¬¡ âœ¨</button>
        <p class="footer">
          Fromï¼šæ°¸è¿œç«™ä½ è¿™è¾¹çš„å§å§ ğŸ’Œ
        </p>
      </div>
    </div>
  </div>

  <script>
    // --- DOM è·å– ---
    const steps = Array.from(document.querySelectorAll('.step'));

    const startBtn = document.getElementById('startBtn');
    const replayBtn = document.getElementById('replayBtn');
    const startPopupBtn = document.getElementById('startPopupBtn');
    const skipToResultBtn = document.getElementById('skipToResultBtn');

    const moodButtons = document.querySelectorAll('.mood-btn');
    const styleButtons = document.querySelectorAll('.style-btn');
    const scoreButtons = document.querySelectorAll('.score-btn');
    const relButtons = document.querySelectorAll('.rel-btn');
    const wishButtons = document.querySelectorAll('.wish-btn');

    const resultTextEl = document.getElementById('resultText');
    const popupArea = document.getElementById('popupArea');

    let selectedMood = '';
    let selectedStyle = '';
    let selectedScore = '';
    let selectedRelation = '';
    let selectedWish = '';

    function goToStep(stepIndex) {
      steps.forEach((el, idx) => {
        el.classList.toggle('active', idx === stepIndex - 1);
      });
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    startBtn.addEventListener('click', () => {
      goToStep(2);
    });

    moodButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        selectedMood = btn.getAttribute('data-mood') || '';
        goToStep(3);
      });
    });

    styleButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        selectedStyle = btn.getAttribute('data-style') || '';
        goToStep(4);
      });
    });

    scoreButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        selectedScore = btn.getAttribute('data-score') || '';
        goToStep(5);
      });
    });

    relButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        selectedRelation = btn.getAttribute('data-rel') || '';
        goToStep(6);
      });
    });

    wishButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        selectedWish = btn.getAttribute('data-wish') || '';
        goToStep(7);
        // åˆ°å¼¹çª—é¡µæ—¶ä¸è‡ªåŠ¨æ’­æ”¾ï¼Œè®©å¥¹è‡ªå·±ç‚¹â€œå¼€å§‹æ’­æ”¾ç¥ç¦å¼¹çª—â€
      });
    });

    // --- ç¥ç¦å¼¹çª—é€»è¾‘ï¼ˆä»¿ CSDN å¼¹çª—ä¾æ¬¡å‡ºç°ï¼‰ ---
    const popupMessages = [
      'æ„¿ä½ ä¸‰å†¬æš–ï¼Œæ˜¥ä¸å¯’ï¼Œå¤©é»‘æœ‰ç¯ï¼Œä¸‹é›¨æœ‰ä¼ï¼Œè·¯ä¸Šæ€»æœ‰äººé™ªä½ æ…¢æ…¢èµ°ã€‚',
      'æ„¿ä½ æ°¸è¿œç›¸ä¿¡è‡ªå·±å€¼å¾—è¢«å¥½å¥½å¯¹å¾…ï¼Œä¹ŸçœŸçš„é‡åˆ°è¿™æ ·çš„äººå’Œäº‹ã€‚',
      'æ„¿ä½ å¿™çš„æ—¶å€™ä¸è§‰å¾—ç´¯ï¼Œé—²çš„æ—¶å€™ä¸è§‰å¾—ç©ºï¼Œæ‰€æœ‰æ—¥å­éƒ½ä¸ç™½è¿‡ã€‚',
      'æ„¿ä½ è¢«è¿™ä¸ªä¸–ç•Œæ¸©æŸ”ä»¥å¾…ï¼Œå°±ç®—å¶å°”æœ‰ç‚¹éš¾è¿‡ï¼Œä¹Ÿæœ‰äººæ›¿ä½ å…œç€é£é›¨ã€‚',
      'æ„¿ä½ æ°¸è¿œä¿ç•™ä¸€ç‚¹å°å­©æ°”ï¼Œå¯ä»¥æ’’å¨‡ï¼Œå¯ä»¥èƒ¡é—¹ï¼Œä½†æ°¸è¿œè¢«è®¤çœŸå¯¹å¾…ã€‚',
      'æ„¿ä½ å¿ƒä¸­æœ‰å…‰ï¼Œçœ¼é‡Œæœ‰ç¬‘ï¼Œç¡å‰æœ‰æœŸå¾…ï¼Œé†’æ¥æœ‰é˜³å…‰ã€‚',
      'æ„¿ä½ èµ°è¿‡çš„æ¯ä¸€æ®µè·¯ï¼Œéƒ½èƒ½åœ¨å›å¤´æ—¶è¢«è‡ªå·±æ¸©æŸ”åœ°å¤¸ä¸€å¥â€œè¿™ä¸€æ­¥ä¹ŸæŒºäº†ä¸èµ·â€ã€‚',
      'æ„¿ä½ æ–°çš„ä¸€å²ï¼šä¸å¿…å¤ªæ‡‚äº‹ï¼Œä¸ç”¨å¤ªä¹–ï¼Œåªè¦å¥½å¥½åšè‡ªå·±å°±å·²ç»å¾ˆæ£’äº†ã€‚'
    ];

    const popupColors = [
      '#ffe4f0', '#ffe9c9', '#e9f5ff', '#e8f9f0',
      '#fce4ec', '#fff7cc', '#e3f2fd', '#f3e5f5'
    ];

    let popupIndex = 0;
    let popupTimer = null;

    function showPopup(index) {
      if (!popupArea) return;
      popupArea.innerHTML = '';

      const msg = popupMessages[index];
      const card = document.createElement('div');
      card.className = 'popup-card';

      const bg = popupColors[index % popupColors.length];
      card.style.background = bg;

      // æ ‡é¢˜ + æ–‡æœ¬
      const title = document.createElement('div');
      title.className = 'popup-title';
      title.textContent = `â¤ ç¥ç¦å¼¹çª— No.${index + 1}`;

      const text = document.createElement('div');
      text.className = 'popup-text';
      text.textContent = msg;

      card.appendChild(title);
      card.appendChild(text);
      popupArea.appendChild(card);
    }

    function startPopupSequence() {
      if (!popupArea) return;

      // é‡ç½®
      stopPopupSequence();
      popupIndex = 0;
      startPopupBtn.disabled = true;
      startPopupBtn.textContent = 'ç¥ç¦æ’­æ”¾ä¸­...';

      showPopup(popupIndex);

      popupTimer = setInterval(() => {
        popupIndex++;
        if (popupIndex >= popupMessages.length) {
          stopPopupSequence();
          startPopupBtn.disabled = false;
          startPopupBtn.textContent = 'å†çœ‹ä¸€è½®ç¥ç¦å¼¹çª—';
          return;
        }
        showPopup(popupIndex);
      }, 2600); // æ¯ 2.6 ç§’åˆ‡ä¸€æ¡
    }

    function stopPopupSequence() {
      if (popupTimer) {
        clearInterval(popupTimer);
        popupTimer = null;
      }
      if (popupArea) {
        popupArea.innerHTML = '';
      }
    }

    startPopupBtn.addEventListener('click', () => {
      startPopupSequence();
    });

    skipToResultBtn.addEventListener('click', () => {
      stopPopupSequence();
      showResult();
      goToStep(8);
      startConfetti();
    });

    // --- æœ€ç»ˆç»“æœæ–‡å­— ---
    function showResult() {
      const moodText = selectedMood || 'å¤–å‘åˆå¯çˆ±çš„å°å¤ªé˜³';
      const styleText = selectedStyle || 'æŒ‰è‡ªå·±çš„èŠ‚å¥ï¼Œèˆ’æœåœ°è¿‡è¿™ä¸€å¤©';
      const scoreText = selectedScore || 'åœ¨æˆ‘å¿ƒé‡Œæ°¸è¿œéƒ½æ˜¯æ»¡åˆ†çš„å°å­©';
      const relationText = selectedRelation || 'äº’æŸäº’å® ã€æ€ä¹ˆéƒ½æ‹†ä¸æ•£çš„æœ€å¥½æ­å­';
      const wishText = selectedWish || 'å¿«ä¹';

      const finalMessage =
        `äº²çˆ±çš„å°æ¸…ç¥ï¼š\n\n` +
        `ç³»ç»Ÿæ£€æµ‹åˆ°ï¼Œä½ ä»Šå¤©çš„çŠ¶æ€æ˜¯ï¼š${moodText}ã€‚\n` +
        `ç†æƒ³çš„ç”Ÿæ—¥è¿‡æ³•æ˜¯ï¼š${styleText}ã€‚\n` +
        `åœ¨ä½ ç»™è‡ªå·±çš„è¿™å¹´æ‰“åˆ†é‡Œï¼š${scoreText}ã€‚\n` +
        `å’Œå§å§ä¹‹é—´çš„å…³ç³»æ ‡ç­¾æ˜¯ï¼š${relationText}ã€‚\n` +
        `æ–°ä¸€å²çš„å…³é”®è¯è®¾å®šä¸ºï¼šã€Œ${wishText}ã€ã€‚\n\n` +
        `åœ¨å§å§è¿™è¾¹ï¼Œä½ æ°¸è¿œä¸ç”¨æ•…ä½œåšå¼ºã€ä¹Ÿä¸ç”¨æ”¶èµ·ä½ çš„å¤–å‘å’ŒçœŸè¯šã€‚\n\n` +
        `æ„¿ä½ æ¥ä¸‹æ¥çš„ä¸€å¹´é‡Œï¼š\n` +
        `Â· å¼€å¿ƒçš„æ—¶å€™æœ‰äººä¸€èµ·é«˜å£°å¤§ç¬‘ ğŸ‰\n` +
        `Â· ä¸å¼€å¿ƒçš„æ—¶å€™ä¹Ÿæœ‰åœ°æ–¹å¯ä»¥èº²ä¸€èº²ã€æ’’ä¸ªå¨‡ ğŸ¤\n` +
        `Â· æ‰€æœ‰åŠªåŠ›éƒ½æœ‰å›åº”ï¼Œæ‰€æœ‰æœŸå¾…éƒ½æœ‰æƒŠå–œ âœ¨\n\n` +
        `ç”Ÿæ—¥å¿«ä¹å‘€ï¼Œå°æ¸…ç¥ã€‚\n` +
        `å°±ç®—å…¨ä¸–ç•Œéƒ½å¾ˆåµï¼Œä½ ä¹Ÿæ°¸è¿œå¯ä»¥æ¥æ‰¾å§å§ã€‚`;

      resultTextEl.textContent = finalMessage;
    }

    // å†ç©ä¸€æ¬¡
    replayBtn.addEventListener('click', () => {
      selectedMood = '';
      selectedStyle = '';
      selectedScore = '';
      selectedRelation = '';
      selectedWish = '';
      resultTextEl.textContent = '';

      stopPopupSequence();
      stopConfetti();
      startPopupBtn.disabled = false;
      startPopupBtn.textContent = 'å¼€å§‹æ’­æ”¾ç¥ç¦å¼¹çª—';

      goToStep(1);
    });

    // --- å½©å¸¦åŠ¨ç”» ---
    const canvas = document.getElementById('confettiCanvas');
    const ctx = canvas.getContext('2d');
    let confettiParticles = [];
    let confettiTimer = null;
    let resizeTimer = null;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(resizeCanvas, 120);
    });

    resizeCanvas();

    function createConfetti() {
      const count = 120;
      const colors = ['#ff4f8b', '#ffb347', '#7dd3fc', '#a5b4fc', '#f9a8d4'];

      confettiParticles = [];
      for (let i = 0; i < count; i++) {
        confettiParticles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * -canvas.height,
          w: 6 + Math.random() * 4,
          h: 8 + Math.random() * 6,
          color: colors[Math.floor(Math.random() * colors.length)],
          speedY: 2 + Math.random() * 3,
          speedX: -1 + Math.random() * 2,
          rotation: Math.random() * Math.PI * 2,
          rotationSpeed: -0.1 + Math.random() * 0.2
        });
      }
    }

    function drawConfetti() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      confettiParticles.forEach(p => {
        p.x += p.speedX;
        p.y += p.speedY;
        p.rotation += p.rotationSpeed;

        if (p.y > canvas.height + 20) {
          p.y = -20;
          p.x = Math.random() * canvas.width;
        }

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rotation);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
        ctx.restore();
      });
    }

    function loopConfetti() {
      drawConfetti();
      confettiTimer = requestAnimationFrame(loopConfetti);
    }

    function startConfetti() {
      createConfetti();
      if (confettiTimer) {
        cancelAnimationFrame(confettiTimer);
      }
      loopConfetti();
      setTimeout(() => {
        stopConfetti();
      }, 5000);
    }

    function stopConfetti() {
      if (confettiTimer) {
        cancelAnimationFrame(confettiTimer);
        confettiTimer = null;
      }
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
  </script>
</body>
</html>
